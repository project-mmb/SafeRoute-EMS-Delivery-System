<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AeroReach ‚Äî Sign Up</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  body{
    margin:0;
    font-family:'Inter';
    background:#020617;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }

  .card{
    width:420px;
    background:#0f172a;
    border-radius:18px;
    padding:28px;
    box-shadow:0 0 30px rgba(0,100,255,0.3);
  }

  h1{
    text-align:center;
    font-size:26px;
    font-weight:700;
    color:#60a5fa;
    margin-bottom:4px;
  }

  .subtitle{
    text-align:center;
    font-size:14px;
    color:#94a3b8;
    margin-bottom:22px;
  }

  .role-select{
    display:flex;
    gap:10px;
    margin-bottom:22px;
  }

  .role-option{
    flex:1;
    text-align:center;
    padding:14px;
    border-radius:14px;
    cursor:pointer;
    font-weight:600;
    background:#1e293b;
    color:#e2e8f0;
    border:1px solid transparent;
    transition:.2s;
  }

  .role-option:hover{
    border-color:#3b82f6;
  }

  .role-active{
    background:#1d4ed8;
    border-color:#3b82f6;
    color:white;
  }

  label{
    color:#cbd5e1;
    font-size:13px;
    display:block;
    margin-top:14px;
  }

  input,select{
    width:100%;
    padding:12px;
    background:#1e293b;
    color:white;
    border:1px solid #334155;
    border-radius:12px;
    margin-top:6px;
  }

  button{
    width:100%;
    margin-top:20px;
    padding:14px;
    background:#2563eb;
    color:white;
    border:none;
    border-radius:14px;
    font-weight:600;
    cursor:pointer;
  }
  button:hover{ background:#1d4ed8; }

  .hidden{ display:none; }

</style>
</head>

<body>
<div class="card">

  <h1>AeroReach</h1>
  <div class="subtitle">Choose your access type</div>

  <div class="role-select">
    <div id="optUser" class="role-option" onclick="selectRole('user')">User</div>
    <div id="optResponder" class="role-option" onclick="selectRole('responder')">Responder</div>
  </div>

  <!-- USER FORM -->
  <div id="userForm" class="hidden">
    <label>Full Name</label>
    <input id="uname">

    <label>Age</label>
    <input type="number" id="uage">

    <label>Village / Area</label>
    <input id="uvillage">

    <label>Medical Focus</label>
    <select id="umedical">
      <option>Injury</option>
      <option>Medication Refill</option>
      <option>Asthma</option>
      <option>Postpartum</option>
      <option>Chronic</option>
      <option>GBV</option>
    </select>

    <button onclick="saveGPS()">üìç Save GPS</button>
    <button onclick="signupUser()">Continue ‚Üí</button>
  </div>

  <!-- RESPONDER FORM -->
  <div id="respForm" class="hidden">
    <label>Name</label>
    <input id="rname">

    <label>Organization</label>
    <input id="rorg">

    <label>Role</label>
    <input id="rrole">

    <label>Email</label>
    <input id="remail">

    <button onclick="signupResponder()">Continue ‚Üí</button>
  </div>
</div>

<!-- Firebase 8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const config = {
  apiKey: "AIzaSyDgEH4QnHBLWzg54MNexYZJaATpRHFC_DA",
  authDomain: "aeroreach-5d4ae.firebaseapp.com",
  databaseURL: "https://aeroreach-5d4ae-default-rtdb.firebaseio.com",
  projectId: "aeroreach-5d4ae",
  storageBucket: "aeroreach-5d4ae.appspot.com",
  messagingSenderId: "477756305528",
  appId: "1:477756305528:web:470f50f591bee98e3e3d8d"
};

firebase.initializeApp(config);
const db = firebase.database();
const auth = firebase.auth();

// Always localStorage
let gps = null;

function selectRole(role){
  optUser.classList.remove("role-active");
  optResponder.classList.remove("role-active");

  if(role==="user"){
    optUser.classList.add("role-active");
    userForm.classList.remove("hidden");
    respForm.classList.add("hidden");
  } else {
    optResponder.classList.add("role-active");
    respForm.classList.remove("hidden");
    userForm.classList.add("hidden");
  }
}

function captureGPS(){
  navigator.geolocation.getCurrentPosition(pos=>{
    gps = {lat:pos.coords.latitude, lng:pos.coords.longitude};
    alert("GPS Saved ‚úî");
  });
}

async function signupUser(){
  const name = uname.value.trim();
  const age  = parseInt(uage.value);
  const village = uvillage.value.trim();
  const medical = umedical.value;

  if(!name || !age || !village){
    alert("Please fill all fields.");
    return;
  }

  if(age < 13){
    alert("Under 13 needs adult help.");
    return;
  }

  // Create anonymous account
  const cred = await auth.signInAnonymously();
  const uid = cred.user.uid;

  await db.ref("users/"+uid).set({
    name,
    age,
    village,
    medical,
    gps: gps || null,
    createdAt: Date.now()
  });

  // Save permanently
  localStorage.setItem("uid", uid);

  window.location="user-hub.html";
}

async function signupResponder(){
  const name = rname.value.trim();
  const org  = rorg.value.trim();
  const role = rrole.value.trim();
  const email= remail.value.trim();

  if(!name || !org || !role || !email){
    alert("Fill all fields.");
    return;
  }

  const cred = await auth.signInAnonymously();
  const id = cred.user.uid;

  await db.ref("responders/"+id).set({
    name,org,role,email,
    createdAt: Date.now()
  });

  localStorage.setItem("responder", id);
  window.location="responder-dashboard.html";
}
</script>


</body>
</html>
