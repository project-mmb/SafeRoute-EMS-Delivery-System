<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AeroReach ‚Äî Emergency Assist</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  body{
    margin:0;
    background:#020617;
    color:#e2e8f0;
    font-family:'Inter',sans-serif;
    display:flex;
    flex-direction:column;
    height:100vh;
  }

  /* HEADER */

  .top{
    padding:16px 20px;
    font-size:18px;
    font-weight:700;
    color:#60a5fa;
    background:rgba(3,8,23,.6);
    backdrop-filter:blur(12px);
    border-bottom:1px solid rgba(59,130,246,0.15);
  }

  /* CHAT AREA */
  #chat{
    flex:1;
    overflow-y:auto;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:14px;
  }

  .bot{
    align-self:flex-start;
    background:rgba(59,130,246,.14);
    padding:12px 16px;
    border-radius:14px;
    max-width:80%;
    border:1px solid rgba(59,130,246,.28);
  }

  .user{
    align-self:flex-end;
    background:#1e3a8a;
    padding:12px 16px;
    border-radius:14px;
    max-width:80%;
  }

  /* BUTTON OPTIONS */
  #options{
    padding:14px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    background:rgba(3,8,23,.75);
    border-top:1px solid rgba(59,130,246,.2);
  }

  .opt{
    padding:10px 14px;
    border-radius:999px;
    background:#1e293b;
    border:1px solid rgba(59,130,246,.25);
    cursor:pointer;
    color:#e2e8f0;
    font-size:14px;
    transition:.2s;
  }

  .opt:hover{
    background:#3b82f6;
    color:white;
  }

  @media(max-width:640px){
    .bot, .user{
      max-width:92%;
      font-size:15px;
    }
  }
</style>
</head>

<body>

<div class="top">üöÅ AeroAssist</div>

<div id="chat"></div>
<div id="options"></div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* -------- Firebase -------- */
const cfg = {
  apiKey:"AIzaSyDgEH4QnHBLWzg54MNexYZJaATpRHFC_DA",
  authDomain:"aeroreach-5d4ae.firebaseapp.com",
  databaseURL:"https://aeroreach-5d4ae-default-rtdb.firebaseio.com",
  projectId:"aeroreach-5d4ae",
};
firebase.initializeApp(cfg);
const db=firebase.database();

const uid = localStorage.getItem("uid");
if(!uid) location="signup.html";

/* -------- State -------- */
let data={ type:null, safety:null, gps:null };
let phase=0;

/* -------- UI Helpers -------- */
function bot(text){
  const c=document.getElementById("chat");
  let p=document.createElement("div");
  p.className="bot";
  p.innerText=text;
  c.appendChild(p);
  c.scrollTop=c.scrollHeight;
}

function user(text){
  const c=document.getElementById("chat");
  let p=document.createElement("div");
  p.className="user";
  p.innerText=text;
  c.appendChild(p);
  c.scrollTop=c.scrollHeight;
}

function options(list){
  const box=document.getElementById("options");
  box.innerHTML="";
  list.forEach(x=>{
    const b=document.createElement("div");
    b.className="opt";
    b.innerText=x;
    b.onclick=()=>answer(x);
    box.appendChild(b);
  });
}

/* -------- Conversation Engine -------- */
function start(){
  bot("Hi, I'm AeroAssist. I‚Äôll help you quickly. üöë");
  setTimeout(()=>{
    bot("What happened?");
    options(["Injury","Bleeding","Asthma","Postpartum","Medication","GBV"]);
  },700);
}

async function answer(txt){
  user(txt);

  if(phase===0){
    data.type=txt;
    phase=1;
    setTimeout(()=>{
      bot("Are you in danger?");
      options(["I'm safe","I feel unsafe"]);
    },500);
  }

  else if(phase===1){
    data.safety=txt;
    phase=2;
    bot("Okay. I need your location.");
    options(["Send GPS"]);
  }

  else if(phase===2){
    bot("Requesting GPS‚Ä¶");
    navigator.geolocation.getCurrentPosition(async p=>{
      data.gps={ lat:p.coords.latitude, lng:p.coords.longitude };

      bot("Location locked. Sending help‚Ä¶ üöÅ");

      const ref=db.ref("alerts").push();
      await ref.set({
        userId:uid,
        emergencyType:data.type,
        safety:data.safety,
        gpsLocation:data.gps,
        status:"Dispatched",
        createdAt:Date.now()
      });
      setTimeout(()=>location="drone.html",900);

    },()=>{
      bot("‚ö†Ô∏è Couldn‚Äôt get GPS. Try again.");
      options(["Retry GPS"]);
    });
  }
}

start();
</script>

</body>
</html>
